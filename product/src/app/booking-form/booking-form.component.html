<div class="form-container">
  <h2>Book Your Spa Appointment</h2>

  <div *ngIf="isBookingSuccess && successResponse" class="message success">
    <h4>Booking Confirmed!</h4>
    <p>Thank you, {{ successResponse!.customerName }}!</p>
    <p>Your confirmation code is: <strong>{{ successResponse!.confirmationCode }}</strong></p>
    <p>
      Service: {{ successResponse!.serviceName }} <br>
      Date: {{ successResponse!.slotDate | date: 'longDate' }} <br>
      Time: {{ successResponse!.startTime | slice:0:5 }}
    </p>
    <p class="confirmation-note">
      <strong>Kindly present this confirmation code at the service desk.</strong>
    </p>
  </div>

  <div *ngIf="errorMessage" class="message error">
    <h4>Booking Failed</h4>
    <p>{{ errorMessage }}</p>
  </div>

  <form #bookingForm="ngForm" (ngSubmit)="onSubmit(bookingForm)" *ngIf="!isBookingSuccess">
    
    <fieldset>
      <legend>Your Details</legend>
      <div class="form-group">
        <label for="customerName">Full Name:</label>
        <input 
          type="text" 
          id="customerName" 
          name="customerName"
          [(ngModel)]="bookingRequest.customerName"
          #nameInput="ngModel"
          required>
        <div *ngIf="nameInput.invalid && nameInput.touched" class="field-error">Name is required.</div>
      </div>

      <div class="form-group">
        <label for="customerEmail">Email:</label>
        <input 
          type="email" 
          id="customerEmail" 
          name="customerEmail"
          [(ngModel)]="bookingRequest.customerEmail"
          #emailInput="ngModel"
          required email>
        <div *ngIf="emailInput.invalid && emailInput.touched" class="field-error">A valid email is required.</div>
      </div>

      <div class="form-group">
        <label for="customerPhone">Phone:</label>
        <input 
          type="tel" 
          id="customerPhone" 
          name="customerPhone"
          [(ngModel)]="bookingRequest.customerPhone">
      </div>
    </fieldset>

    <fieldset>
      <legend>Select a Service</legend>
      <div class="form-group">
        <label for="serviceId">Service:</label>
        <select 
          id="serviceId" 
          name="serviceId"
          [(ngModel)]="bookingRequest.serviceId"
          #serviceInput="ngModel"
          required
          [class.is-invalid]="serviceInput.invalid && serviceInput.touched">
          <option [ngValue]="0" disabled>-- Select a service --</option>
          <option *ngFor="let service of services" [ngValue]="service.id">
            {{ service.name }} - {{ service.price | currency:'PHP':'symbol-narrow' }} ({{ service.durationMinutes }} min)
          </option>
        </select>
        <div *ngIf="serviceInput.invalid && serviceInput.touched" class="field-error">Please select a service.</div>
      </div>
    </fieldset>

    <fieldset>
      <legend>Select a Schedule</legend>
      <div class="form-group">
        <label for="timeSlotId">Available Time:</label>
        <select 
          id="timeSlotId" 
          name="timeSlotId"
          [(ngModel)]="bookingRequest.timeSlotId"
          #timeInput="ngModel"
          required
          [class.is-invalid]="timeInput.invalid && timeInput.touched">
          <option [ngValue]="0" disabled>-- Select a time slot --</option>
          <option *ngFor="let slot of timeslots" [ngValue]="slot.id">
            {{ slot.slotDate | date: 'fullDate' }} at {{ slot.startTime | slice:0:5 }}
          </option>
        </select>
        <div *ngIf="timeInput.invalid && timeInput.touched" class="field-error">Please select a time slot.</div>
        <div *ngIf="timeslots.length === 0" class="field-error">No available time slots.</div>
      </div>
    </fieldset>

    <button type="submit" [disabled]="bookingForm.invalid || isLoading">
      {{ isLoading ? 'Booking...' : 'Book Now' }}
    </button>
  </form>
</div>