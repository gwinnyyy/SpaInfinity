<div class="form-container">
  <h2>Book Your Spa Appointment</h2>

  <div *ngIf="isBookingSuccess && successResponse" class="message success">
    <h4>âœ“ Booking Confirmed!</h4>
    <p>Thank you, <strong>{{ successResponse.customerName }}</strong>!</p>
    
    <div class="confirmation-details">
      <div class="confirmation-code">
        <p class="label">Confirmation Code:</p>
        <p class="code">{{ successResponse.confirmationCode }}</p>
      </div>
      
      <div class="booking-info">
        <p><strong>Service:</strong> <span>{{ successResponse.serviceName }}</span></p>
        <p><strong>Price:</strong> <span>{{ successResponse.servicePrice | currency:'PHP':'symbol-narrow' }}</span></p>
        <p><strong>Date:</strong> <span>{{ successResponse.slotDate | date: 'fullDate' }}</span></p>
        <p><strong>Time:</strong> <span>{{ successResponse.startTime | slice:0:5 }}</span></p>
      </div>
      
      <div class="important-note">
        <p> <strong>IMPORTANT:</strong> Keep this confirmation code for verification at the establishment.</p>
      </div>
      
      <button (click)="isBookingSuccess = false" class="btn-new-booking">Make Another Booking</button>
    </div>
  </div>

  <div *ngIf="errorMessage" class="message error">
    <h4> Booking Failed</h4>
    <p>{{ errorMessage }}</p>
  </div>

  <form #bookingForm="ngForm" (ngSubmit)="onSubmit(bookingForm)" *ngIf="!isBookingSuccess">
    
    <fieldset>
      <legend>Your Details</legend>
      <div class="form-group">
        <label for="customerName">Full Name: <span class="required">*</span></label>
        <input 
          type="text" 
          id="customerName" 
          name="customerName"
          [(ngModel)]="bookingRequest.customerName"
          #nameInput="ngModel"
          required
          placeholder="Enter your full name">
        <div *ngIf="nameInput.invalid && nameInput.touched" class="field-error">Name is required.</div>
      </div>

      <div class="form-group">
        <label for="customerEmail">Email: <span class="required">*</span></label>
        <input 
          type="email" 
          id="customerEmail" 
          name="customerEmail"
          [(ngModel)]="bookingRequest.customerEmail"
          #emailInput="ngModel"
          required 
          email
          placeholder="your@email.com">
        <div *ngIf="emailInput.invalid && emailInput.touched" class="field-error">A valid email is required.</div>
      </div>

      <div class="form-group">
        <label for="customerPhone">Phone:</label>
        <input 
          type="tel" 
          id="customerPhone" 
          name="customerPhone"
          [(ngModel)]="bookingRequest.customerPhone"
          placeholder="09171234567">
      </div>
    </fieldset>

    <fieldset>
      <legend>Select a Service</legend>
      <div class="form-group">
        <label for="serviceId">Service: <span class="required">*</span></label>
        <select 
          id="serviceId" 
          name="serviceId"
          [(ngModel)]="bookingRequest.serviceId"
          #serviceInput="ngModel"
          required
          [class.is-invalid]="serviceInput.invalid && serviceInput.touched">
          <option [value]="0" disabled>-- Select a service --</option>
          <option *ngFor="let service of services" [value]="service.id">
            {{ service.name }} - {{ service.price | currency:'PHP':'symbol-narrow' }} ({{ service.durationMinutes }} min)
          </option>
        </select>
        <div *ngIf="serviceInput.invalid && serviceInput.touched" class="field-error">Please select a service.</div>
      </div>
    </fieldset>

    <fieldset>
      <legend>Select a Schedule</legend>
      <div class="form-group">
        <label for="timeSlotId">Available Time: <span class="required">*</span></label>
        <select 
          id="timeSlotId" 
          name="timeSlotId"
          [(ngModel)]="bookingRequest.timeSlotId"
          #timeInput="ngModel"
          required
          [class.is-invalid]="timeInput.invalid && timeInput.touched">
          <option [value]="0" disabled>-- Select a time slot --</option>
          <option *ngFor="let slot of timeslots" [value]="slot.id">
            {{ slot.slotDate | date: 'EEE, MMM d, y' }} at {{ slot.startTime | slice:0:5 }}
          </option>
        </select>
        <div *ngIf="timeInput.invalid && timeInput.touched" class="field-error">Please select a time slot.</div>
        <div *ngIf="timeslots.length === 0" class="field-warning">
           No available time slots. Please contact the spa or check back later.
        </div>
      </div>
    </fieldset>

    <button type="submit" [disabled]="bookingForm.invalid || isLoading || timeslots.length === 0">
      {{ isLoading ? 'Processing...' : 'Book Now' }}
    </button>
  </form>
</div>